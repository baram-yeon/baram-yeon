const DataManager=function(){const t=window.CommonData.CATEGORY_FILE_MAP,r=window.CommonData.FACTION_ICONS,a=window.CommonData.STATS_MAPPING,e=window.CommonData.STATS_ORDER||[],n=window.CommonData.SPECIAL_STAT_CLASSES;let o={"수호":[],"탑승":[],"변신":[]};function i(t,r){return t.map((t=>{if(!t||"object"!=typeof t||!t.name)return null;const a=r.find((r=>r&&r.name===t.name)),e=Array.isArray(t.stats)?t.stats:[],n=a&&Array.isArray(a.stats)?a.stats:[],o=Array.from({length:26},((t,r)=>{const a=r,o=e.find((t=>t&&t.level===a)),i=n.find((t=>t&&t.level===a));return{level:a,registrationStat:o?.registrationStat||{},bindStat:i?.bindStat||{}}}));return{...t,stats:o,influence:t.influence||"정보없음"}})).filter((t=>null!==t))}function s(t,r){if(!t||!Array.isArray(t)||0===t.length)return!1;for(let a=0;a<=25;a++){const e=t.find((t=>t&&t.level===a));if(!e||!e[r]||"object"!=typeof e[r]||0===Object.keys(e[r]).length)return!1}return!0}return{loadCategoryData:async function(){let a=!0;for(const[r,e]of Object.entries(t))try{let t=await FirebaseHandler.getFirestoreDocument(e.registration),n=await FirebaseHandler.getFirestoreDocument(e.bind),s=Array.isArray(t)?t:t?.data||[],l=Array.isArray(n)?n:n?.data||[];Array.isArray(s)||(console.error(`Invalid registration data format for ${r}: Expected array, got ${typeof s}. Using empty array.`),s=[],a=!1),Array.isArray(l)||(console.error(`Invalid bind data format for ${r}: Expected array, got ${typeof l}. Using empty array.`),l=[],a=!1),0===s.length&&e.registration&&console.warn(`No registration data loaded for category: ${r} from file ${e.registration}.json`);const c=i(s,l);o[r]=c}catch(t){console.error(`Failed to load or process data for category ${r}:`,t),o[r]=[],a=!1}return a||console.error("One or more categories failed to load data properly."),r||console.error("FACTION_ICONS data is missing from CommonData!"),o},getData:function(t){return o[t]||[]},getAllData:function(){return o},checkSpiritStats:function(t){return t&&t.stats?{hasFullRegistration:s(t.stats,"registrationStat"),hasFullBind:s(t.stats,"bindStat")}:{hasFullRegistration:!1,hasFullBind:!1}},checkAllLevelsHaveEffect:s,hasLevel25BindStats:function(t){if(!t||!Array.isArray(t.stats))return!1;const r=t.stats.find((t=>t&&25===t.level));return r&&r.bindStat&&"object"==typeof r.bindStat&&Object.keys(r.bindStat).length>0},FACTION_ICONS:r,STATS_MAPPING:a,STATS_ORDER:e,SPECIAL_STAT_CLASSES:n}}();window.DataManager=DataManager;